{% extends 'base.html' %}
{% block titulo_pagina %} Evaluacion de Riesgo {% endblock titulo_pagina %}
{% block titulo %}Evaluacion de Riesgo{% endblock titulo %}
{% block contenido %}
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-green">
                <div class="panel-heading">Informacion General</div>
                <div class="panel-body">
                    <div class="row">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-addon">Localizaci처n</span>
                        {{ form.localizacion }}
                        {{ form.localizacion.errors }}
                    </div>
                    <br>
                </div>
                <div class="col-md-6">
                    <div class="input-group date">
                        <span class="input-group-addon">Fecha Evaluacion</span>
                        {{ form.fecha_eval }}
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
                        {{ form.fecha_eval.errors }}
                    </div>
                </div>
            </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-addon">Puesto de Trabajo</span>
                                {{ form.puesto }}
                                {{ form.puesto.errors }}
                            </div>
                            <br>
                        </div>
                        <div class="col-md-6">
                            <div class="input-group date">
                                <span class="input-group-addon">Fecha Ultima Evaluacion</span>
                                {{ form.fecha_ul_eval }}
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                                {{ form.fecha_ul_eval.errors }}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-addon">N째 de Trabajadores</span>
                        {{ form.trabajadores }}
                        {{ form.trabajadores.errors }}
                    </div>
                </div>
                <br>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for=""></label>
                    </div>
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-green">
            <div class="panel-heading">
                Detalle
                <div class="pull-right">
                    <a id="nuevo" class="btn btn-default btn-xs" href="#"><i class="fa fa-plus"></i></a>
                    <a class="btn btn-default btn-xs" href=""><i class="fa fa-floppy-o"></i></a>
                </div>
            </div>
            <div class="panel-body">
                <table id="tb_eval" class="table table-bordered">
                    <thead>
                        <tr>
                            <th>N째</th>
                            <th>Factor Riesgo</th>
                            <th>Peligro Identificado</th>
                            <th>Probabilidad</th>
                            <th>Consecuencia</th>
                            <th>Estimaci처n</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        </div>
    </div>

    <script type="text/javascript">
        var friesgo_list = [];
        var num=1;
        $(document).ready(function(){
            //Para cargar los factores de riesgo
             $.ajax({
                 dataType: "json",
                contentType:"application/json; charset=utf-8",
                 url: "/carga_friesgos/",
                 type: "get",
                 success: function(response){
                    for(var i=0; i<response.length; i++){
                        friesgo_list.push([response[i].nombre, response[i].id]);
                    }
                     agregar_filas();
                     cargar_friesgo();
                     console.log(friesgo_list);
                 }
             });
        });

        //Agregar nueva fila a la tabla e incrementa el acumulador para los ids
        $("#nuevo").click(function(){
            num +=1;
           agregar_filas();
            cargar_friesgo();
        });

        function agregar_filas(){
            $("#tb_eval tbody").append(
                    '<tr><td>'+num+'</td>'+
                    '<td><select class="form-control" id="sfr'+num+'"></select></td>'+
                    '<td><select class="form-control" id="spi'+num+'"></select></td>'+
                    '<td><select class="form-control" id="sprob'+num+'"></select></td>'+
                    '<td><select class="form-control" id="scon'+num+'"></select></td>'+
                    '<td></td>'+
                    '</tr>'
            );
        }

        function cargar_friesgo(){
            for(var j=0; j<friesgo_list.length; j++){
                console.log("Ingresa");
                $("#sfr"+num+"").append(new Option(friesgo_list[j][0],friesgo_list[j][1]));
            }
        }


        $(function () {
            var picker = $('.date').datetimepicker({
                locale: 'es',
                showTodayButton: true,
                format: 'YYYY-MM-DD'
            });
        });
        $("#nuevo").click(function(){
           console.log("Hola");
        });
    </script>
{% endblock contenido %}