{% extends 'base.html' %}
{% block titulo_pagina %}Peligros de Evaluacion de Riesgo{% endblock titulo_pagina %}
{% block titulo %}Peligros de Evaluacion <span style="color: green">{{ id_er }}</span>{% endblock titulo %}
{% block contenido %}
    <div class="row">
        <div class="col-lg-12">
            <div class="alert alert-success">
                <span><strong>Fecha Evaluacion:</strong> {{ er.fecha_eval }}</span>
                &nbsp;&nbsp;
                <span><strong>Puesto:</strong> {{ er.puesto }}</span>
                &nbsp;&nbsp;
                <span><strong>Responsable:</strong> {{ er.usuario.first_name }} {{ er.usuario.last_name }}</span>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-info">
                <div class="panel-heading"><strong>Peligros</strong>
                    <div class="pull-right">
                        <a id="edit_peli" class="btn btn-warning btn-xs"><i class="fa fa-edit"></i> Editar</a>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="table-responsive form-inline">
                        <table id="tb_peligros" class="table table-bordered table-striped display table-color" aria-describedby="lista de evaluaciones">

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">

        var datos = [];
        var probabilidad = [[],[],[]];
        var consecuencia = [[],[],[]];
        var estimacion = [[],[],[],[],[]];
        console.log("Test1");

        $(document).ready(function(){
            console.log("Test2");
            obtiene_colores();
        });

        function obtiene_colores(){
            $.ajax({
                dataType: "json",
                contentType:"application/json; charset=utf-8",
                url: "/carga_colores/",
                type: "get",
                success: function(response){

                    //Para llenar probabilidad y consecuencia
                    for(var i=0; i<(response["colores"].length); i++){
                        probabilidad[i][0]= response["colores"][0]["probabilidad"][i].abr;
                        probabilidad[i][1]= response["colores"][0]["probabilidad"][i].nombre;
                        probabilidad[i][2]= response["colores"][0]["probabilidad"][i].color;

                        consecuencia[i][0]= response["colores"][1]["consecuencia"][i].abr;
                        consecuencia[i][1]= response["colores"][1]["consecuencia"][i].nombre;
                        consecuencia[i][2]= response["colores"][1]["consecuencia"][i].color;
                    }

                    //Para llenar estimacion
                    for(var j=0; j< response["colores"][2]["estimacion"].length; j++){
                        estimacion[j][0]= response["colores"][2]["estimacion"][j].abr;
                        estimacion[j][1]= response["colores"][2]["estimacion"][j].nombre;
                        estimacion[j][2]= response["colores"][2]["estimacion"][j].color;
                    }
                    carga_datos();
                }
            });
        }

        function carga_datos(){

            {% for pe in peligros %}
                datos.push(["{{ pe.orden }}","{{ pe.peligro_det.factor_r.nombre }}", "{{ pe.peligro_det.nombre }}",
                    "{{ pe.probabilidad }}", "{{ pe.consecuencias }}", "{{ pe.estimacion }}", "{{ pe.priorizacion }}"]);
            {% endfor %}

            var tb_peligros = $("#tb_peligros").DataTable({
                "data": datos,
                "columns":[
                    {"title": "NÂ°"},
                    {"title": "Factor de Riesgo"},
                    {"title": "Peligro Identificado"},
                    {"title": "Probabilidad"},
                    {"title": "Consecuencia"},
                    {"title": "Estimacion de Riesgo"},
                    {"title": "Priorizacion"}
                ]
            });
            establece_colores();
        }

        function establece_colores(){

        }
    </script>
{% endblock contenido %}